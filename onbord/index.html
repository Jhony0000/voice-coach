<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Complete Signup</title>
    <script src="https://unpkg.com/gotrue-js@0.11.0/dist/gotrue.min.js"></script>
  </head>
  <body>
    <h2>Complete Your Signup</h2>
    <form id="signup-form">
      <input type="text" id="fullName" placeholder="Full Name" required />
      <input
        type="password"
        id="password"
        placeholder="Set Password"
        required
      />
      <button type="submit">Set Password & Login</button>
      <p id="message"></p>
    </form>

    <script>
      const hash = window.location.hash;
      const inviteToken = hash.includes("invite_token=")
        ? hash.split("invite_token=")[1]
        : null;
      const form = document.getElementById("signup-form");
      const message = document.getElementById("message");

      const auth = new GoTrue({
        APIUrl: "https://YOUR-SITE.netlify.app/.netlify/identity",
        setCookie: true,
      });

      if (!inviteToken) {
        message.textContent = "No invite token found in URL.";
        form.style.display = "none";
      }

      form.addEventListener("submit", function (e) {
        e.preventDefault();
        const fullName = document.getElementById("fullName").value;
        const password = document.getElementById("password").value;

        auth
          .acceptInvite(inviteToken, password, {
            data: { full_name: fullName },
          })
          .then((user) => {
            message.textContent = "Signup successful! Redirecting...";
            setTimeout(() => {
              window.location.href = "/admin/";
            }, 1500);
          })
          .catch((err) => {
            console.error(err);
            message.textContent = "Signup failed: " + err.message;
          });
      });
    </script>
  </body>
</html>
